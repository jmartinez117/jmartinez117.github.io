<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jesús R. Martínez Urrutia — NixOS Desktop • Portfolio</title>
  <meta name="description" content="Interactive Linux desktop portfolio — responsive, password-gated, draggable windows.">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'nonce-jnx2025'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://brand.nixos.org https://upload.wikimedia.org; frame-src 'self'; object-src 'none'; base-uri 'none'; frame-ancestors 'none'; upgrade-insecure-requests">
  <meta http-equiv="Referrer-Policy" content="no-referrer">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta name="color-scheme" content="dark light">
  <style>
:root{
  --bg-1:#0d1220; --bg-2:#0a1a2f;
  --accent:#5277C3; --accent-2:#7EBAE4;
  --ink:#e7ecff; --muted:#b8c3e6;
  --line:#233053; --panel:#0f1b33; --panel-2:#101a30;
  --win:#121f3b; --task:#0a1428; --ok:#14b8a6; --warn:#f59e0b; --bad:#ef4444;
  --shadow:0 18px 50px rgba(0,0,0,.45);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
  font-size: clamp(14px, 1.6vw, 16px);
  color:var(--ink);
  background: url('bg.svg') center / cover fixed no-repeat,
              linear-gradient(120deg, var(--bg-1), var(--bg-2));
  overflow:hidden;
}
.topbar{
  position:fixed;inset:0 0 auto 0;height:46px;display:flex;align-items:center;gap:12px;
  background:linear-gradient(180deg, rgba(0,0,0,.25), transparent);
  border-bottom:1px solid var(--line);padding:0 12px;z-index:1000;
  backdrop-filter:blur(8px); -webkit-backdrop-filter: blur(8px);
}
.nixlogo{display:inline-flex;align-items:center;gap:10px;padding:6px 10px;border-radius:10px;background:rgba(0,0,0,.28);border:1px solid var(--line)}
.nixlogo img{height:22px;width:auto;display:block}
.title{font-weight:600;font-size:clamp(14px,1.8vw,16px)}
.spacer{flex:1}
.status{display:flex;gap:10px;color:var(--muted);font-size:clamp(12px,1.4vw,14px)}
.hidden{display:none !important}
/* Login */
.login{position:fixed;inset:0;display:grid;place-items:center;z-index:1500;background:linear-gradient(160deg, #08101f, #0b1830)}
.loginbox{width:min(520px, 92vw);padding:22px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,.04), transparent), #0f1d38;border:1px solid var(--line); box-shadow:var(--shadow)}
.loginbox h1{margin:0 0 6px 0;font-size:22px}
.input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:#0b142b;color:var(--ink)}
#login-error{color:#ff7373;font-size:12px;height:14px;opacity:.9;margin-top:6px}
/* Dock */
.dock{position:fixed;inset:auto 12px 58px auto;display:grid;gap:6px 12px;grid-auto-flow:row;justify-items:center}
.icon{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,var(--panel),var(--panel-2));border:1px solid var(--line);display:grid;place-items:center;box-shadow:var(--shadow);cursor:pointer;transition:transform .12s ease}
.icon:hover{transform:translateY(-2px)}.icon svg{width:28px;height:28px}
.label{font-size:12px;color:var(--muted);margin-top:0}
/* Windows */
.win{
  position:absolute;top:90px;left:8vw;width:84vw;max-height:70vh;display:grid;grid-template-rows:auto 1fr;
  background:linear-gradient(180deg, rgba(255,255,255,.03), transparent), var(--win);
  border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);overflow:hidden
}
.titlebar{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid var(--line);background:linear-gradient(180deg, rgba(255,255,255,.05), transparent);user-select:none;touch-action:none;cursor:move}
.tb-title{font-weight:600}.tb-actions{margin-left:auto;display:flex;gap:8px}
button.btn{width:14px;height:14px;border-radius:999px;border:1px solid var(--line);cursor:pointer;background:transparent;padding:0}
button.btn.close{background:var(--bad)} button.btn.min{background:var(--warn)} button.btn.max{background:var(--ok)}
button.btn:focus{outline:2px solid rgba(255,255,255,.3)}
.content{padding:16px;overflow:auto}
.terminal{background:#0a0f1e;border:1px solid #1b2442;border-radius:12px;padding:12px 14px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;font-size:14px;color:#cfe0ff}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
.card{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent), #0f1d38;border:1px solid var(--line);border-radius:14px;padding:16px}
.chips{display:flex;flex-wrap:wrap;gap:10px}
.chip{background:#111f3c;border:1px solid #2b3a6a;color:#dbe6ff;padding:8px 12px;border-radius:999px;font-size:.95rem}
/* Taskbar */
.taskbar{position:fixed;inset:auto 0 0 0;height:52px;display:flex;align-items:center;gap:10px;padding:0 10px;background:linear-gradient(0deg, rgba(0,0,0,.2), transparent);border-top:1px solid var(--line);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
.taskbtn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;background:rgba(0,0,0,.18);border:1px solid var(--line);color:var(--ink);cursor:pointer;max-width:220px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.center-intro{position:fixed;inset:0;display:grid;place-items:center;pointer-events:none}
.center-intro .inner{background:rgba(0,0,0,.15);border:1px solid var(--line);padding:14px 18px;border-radius:12px;color:var(--muted)}
a{color:var(--accent);text-decoration:none}a:hover{text-decoration:underline}
pre{white-space:pre-wrap;word-wrap:break-word; line-height:1.35; font-size:14px}

/* Responsive */
@media (max-width:900px){ .win{left:5vw;width:90vw} }
@media (max-width:700px){
  .dock{inset:auto 50% 64px auto;transform:translateX(50%);grid-auto-flow:column}
  .label{display:none}
  .icon{width:52px;height:52px}.icon svg{width:26px;height:26px}
  .win{top:70px;left:2vw;width:96vw;max-height:calc(100vh - 120px)}
  .title{font-size:clamp(14px,3.5vw,18px)}
  .status{font-size:clamp(12px,3.1vw,16px)}
}
  </style>
</head>
<body>
  <!-- LOGIN SCREEN (password required: HireMe2025!) -->
  <div id="login" class="login">
    <div class="loginbox">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <img alt="NixOS logo" src="https://brand.nixos.org/logos/nixos-logomark-default-gradient-recommended.svg" height="32" width="32">
        <h1 style="margin:0">NixOS — Session</h1>
      </div>
      <p style="color:var(--muted);margin-top:0">Enter the passphrase to open the desktop experience.</p>
      <input id="password" class="input" type="password" placeholder="Password (hint: year you're hiring me)">
      <div id="login-error" role="alert" aria-live="polite"></div>
      <div style="display:flex;gap:10px;margin-top:12px">
        <button id="login-btn" type="button" class="input" style="cursor:pointer;background:linear-gradient(135deg,var(--accent),var(--accent-2));border:1px solid var(--line)">Enter</button>
      </div>
      <p style="color:var(--muted);font-size:12px;margin-top:10px">Privacy note: static site — no data leaves your browser.</p>
    </div>
  </div>

  <!-- DESKTOP -->
  <div id="desktop" class="hidden">
    <div class="topbar" role="banner">
      <div class="nixlogo" title="NixOS" aria-label="NixOS">
        <img alt="NixOS logo" src="https://brand.nixos.org/logos/nixos-logomark-default-gradient-recommended.svg">
        <span class="title">NixOS Desktop</span>
      </div>
      <div class="spacer"></div>
      <div class="status"><span>jesus@nixos</span><span aria-hidden="true">•</span><span id="clock" aria-live="polite"></span></div>
    </div>

    <!-- Dock -->
    <div class="dock" aria-label="App Dock">
      <div class="icon" data-open="#win-about" role="button" tabindex="0" title="About">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
      </div><div class="label">About</div>
      <div class="icon" data-open="#win-resume" role="button" tabindex="0" title="Resume">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16l6-3 6 3V8z"/></svg>
      </div><div class="label">Resume</div>
      <div class="icon" data-open="#win-projects" role="button" tabindex="0" title="Projects">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M3 7h18M3 12h18M3 17h18"/></svg>
      </div><div class="label">Projects</div>
      <div class="icon" data-open="#win-terminal" role="button" tabindex="0" title="Terminal">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M8 9l3 3-3 3M13 15h3"/></svg>
      </div><div class="label">Terminal</div>
      <div class="icon" data-open="#win-mousepad" role="button" tabindex="0" title="Mousepad">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M4 4h16v16H4zM8 8h8M8 12h8M8 16h5"/></svg>
      </div><div class="label">Mousepad</div>
      <div class="icon" data-open="#win-settings" role="button" tabindex="0" title="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V22a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9c0 .66.26 1.3.73 1.77.48.47 1.12.73 1.77.73H22a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      </div><div class="label">Settings</div>
      <div class="icon" data-open="#win-contact" role="button" tabindex="0" title="Contact">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M4 4h16v12H5.17L4 17.17V4z"/><path d="m22 6-10 7L2 6"/></svg>
      </div><div class="label">Contact</div>
    </div>

    <!-- WINDOWS -->
    <section class="win" id="win-about" style="top:86px;left:6vw" role="dialog" aria-label="About">
      <div class="titlebar">
        <span class="tb-title">About</span>
        <div class="tb-actions">
          <button class="btn min" data-min="#win-about" aria-label="Minimize"></button>
          <button class="btn max" data-max="#win-about" aria-label="Maximize"></button>
          <button class="btn close" data-close="#win-about" aria-label="Close"></button>
        </div>
      </div>
      <div class="content">
        <div class="terminal" role="region" aria-label="neofetch output"><pre id="neofetch"></pre></div>
        <p style="color:var(--muted);margin-top:12px">
          Hi! I’m Jesús — a Security+ certified, hands-on IT professional moving deeper into security.
          I enjoy troubleshooting complex connectivity issues, reading firewall and endpoint logs,
          and automating repetitive triage with Python. I’m actively seeking an IT role — ideally as a
          <strong>Technical Support Engineer</strong> or <strong>SOC/Cybersecurity Analyst (Tier-1)</strong> — where I can combine support discipline with security operations and grow my detection & response skills.
        </p>
      </div>
    </section>

    <section class="win hidden" id="win-resume" role="dialog" aria-label="Resume">
      <div class="titlebar">
        <span class="tb-title">Resume</span>
        <div class="tb-actions">
          <button class="btn min" data-min="#win-resume" aria-label="Minimize"></button>
          <button class="btn max" data-max="#win-resume" aria-label="Maximize"></button>
          <button class="btn close" data-close="#win-resume" aria-label="Close"></button>
        </div>
      </div>
      <div class="content">
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
          <a class="taskbtn" href="resume.pdf" target="_blank">Open PDF (new tab)</a>
        </div>
        <div id="resume-struct">
          <h3>Experience</h3>
          <div class="card">
            <strong>Technical Support Engineer (Level 1 → Security-Aware Tier 2) — ONESUPPORT</strong>
            <div class="muted">May 2023 – Present · Mexico City (remote), US-based ISP</div>
            <ul>
              <li>Resolve ~30 connectivity, OS and SaaS tickets/day; SLA &gt;95%.</li>
              <li>Review FortiGate logs; open ~10 follow-up SOC cases/month.</li>
              <li>Weekly Nessus Essentials scans on ~50 endpoints; report critical CVEs.</li>
              <li>Python + VirusTotal automation saves ~10 min per malware ticket.</li>
              <li>Assist with firewall rule changes; authored 25 KB articles.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section class="win hidden" id="win-projects" role="dialog" aria-label="Projects">
      <div class="titlebar">
        <span class="tb-title">Projects</span>
        <div class="tb-actions">
          <button class="btn min" data-min="#win-projects" aria-label="Minimize"></button>
          <button class="btn max" data-max="#win-projects" aria-label="Maximize"></button>
          <button class="btn close" data-close="#win-projects" aria-label="Close"></button>
        </div>
      </div>
      <div class="content">
        <div class="grid">
          <div class="card">
            <h4>cloudflare-lab</h4>
            <p class="muted">Cloudflare Pages lab — deployment/test project.</p>
            <p><a id="proj-cloudflare" href="https://cloudflare-lab-81v.pages.dev/" target="_blank" rel="noopener noreferrer">Open project</a></p>
          </div>
          <div class="card">
            <h4>vt_batch</h4>
            <p class="muted">Python tool to hash files and bulk-query VirusTotal for faster malware triage.</p>
            <a href="https://github.com/jmartinez117/vt_batch" target="_blank" rel="noopener noreferrer">Source</a>
          </div>
          <div class="card">
            <h4>log_pulse</h4>
            <p class="muted">Mini log viewer parsing common firewall formats for quick IOC scanning.</p>
            <a href="https://github.com/jmartinez117/log_pulse" target="_blank" rel="noopener noreferrer">Source</a>
          </div>
        </div>
      </div>
    </section>

    <section class="win hidden" id="win-terminal" role="dialog" aria-label="Terminal">
      <div class="titlebar">
        <span class="tb-title">Terminal</span>
        <div class="tb-actions">
          <button class="btn min" data-min="#win-terminal" aria-label="Minimize"></button>
          <button class="btn max" data-max="#win-terminal" aria-label="Maximize"></button>
          <button class="btn close" data-close="#win-terminal" aria-label="Close"></button>
        </div>
      </div>
      <div class="content">
        <div class="terminal" style="height:48vh;overflow:auto" id="term-out"></div>
        <input id="term-in" class="input" placeholder="Type a command (try 'help')" />
      </div>
    </section>

    <section class="win hidden" id="win-settings" role="dialog" aria-label="Settings">
      <div class="titlebar">
        <span class="tb-title">Settings</span>
        <div class="tb-actions">
          <button class="btn min" data-min="#win-settings" aria-label="Minimize"></button>
          <button class="btn max" data-max="#win-settings" aria-label="Maximize"></button>
          <button class="btn close" data-close="#win-settings" aria-label="Close"></button>
        </div>
      </div>
      <div class="content">
        <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px">
          <div class="card">
            <h4>Display</h4>
            <label>Brightness: <input id="range-brightness" type="range" min="50" max="130" value="100"></label><br/>
            <label>Contrast: <input id="range-contrast" type="range" min="70" max="130" value="100"></label>
            <p class="muted">Adjusts the whole interface in real-time. Saved locally.</p>
          </div>
          <div class="card">
            <h4>Accent theme</h4>
            <label style="display:block;margin-bottom:6px"><input type="radio" name="accent" value="nixos" checked> NixOS (blue)</label>
            <label style="display:block;margin-bottom:6px"><input type="radio" name="accent" value="ubuntu"> Ubuntu (orange)</label>
            <label style="display:block;"><input type="radio" name="accent" value="kali"> Kali (cyan)</label>
          </div>
          <div class="card">
            <h4>Clock</h4>
            <label><input id="toggle-24" type="checkbox"> 24-hour time</label>
          </div>
        </div>
      </div>
    </section>

    <div class="taskbar" aria-label="Taskbar">
      <div id="tasks" style="display:flex;gap:8px;flex-wrap:wrap"></div>
      <div class="spacer"></div>
      <div class="muted" style="padding-right:10px">© <span id="year"></span> Jesús R. Martínez Urrutia</div>
    </div>
    <div class="center-intro"><div class="inner">Click icons to open/bring to front. Close just hides — reopen anytime from the dock.</div></div>
  </div>

  <script nonce="jnx2025">
/* NixOS Desktop v7 — mobile fixes + always require password + CSP nonce */
'use strict';
const qs=(s,e=document)=>e.querySelector(s), qsa=(s,e=document)=>Array.from(e.querySelectorAll(s));

// ----- Clock (Mexico City) -----
function updateClock(){
  const d = new Date();
  const use24 = localStorage.getItem('clock24') === '1';
  const fmt = new Intl.DateTimeFormat('en-US', {
    timeZone:'America/Mexico_City', hour:'2-digit', minute:'2-digit', second:'2-digit',
    year:'numeric', month:'short', day:'2-digit', hour12: !use24
  });
  const el=qs('#clock'); if (el) el.textContent = fmt.format(d) + ' (Mexico City)';
  const y=qs('#year'); if (y) y.textContent = String(d.getFullYear());
}
setInterval(updateClock, 1000); updateClock();

// ----- Login (always required) -----
const REQUIRED_PW='HireMe2025!';
const login=qs('#login'), desktop=qs('#desktop');
const loginBtn=qs('#login-btn'), pwInput=qs('#password'), loginError=qs('#login-error');
function unlock(){ login.classList.add('hidden'); desktop.classList.remove('hidden'); }
function tryUnlock(){
  const pw = pwInput.value.trim();
  if (pw===REQUIRED_PW){ unlock(); }
  else {
    loginError.textContent='Incorrect password.'; loginError.style.opacity='1';
    qs('.loginbox').animate([{transform:'translateX(0)'},{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:250});
  }
}
if (loginBtn) loginBtn.addEventListener('click', tryUnlock);
if (pwInput) pwInput.addEventListener('keydown', e=>{ if(e.key==='Enter') tryUnlock(); });
// No auto-unlock. No localStorage/session flag stored.

// ----- Window manager (pointer events; ignore controls when dragging) -----
let z=10;
function bring(el){ el.style.zIndex=String(++z); }
function keepInView(win){
  const r = win.getBoundingClientRect();
  const pad = 8;
  const maxL = window.innerWidth - r.width - pad;
  const maxT = window.innerHeight - r.height - 72;
  win.style.left = Math.max(pad, Math.min(r.left, Math.max(pad, maxL))) + 'px';
  win.style.top  = Math.max(54,  Math.min(r.top,  Math.max(54,  maxT))) + 'px';
}
function makeDraggable(win){
  const bar = qs('.titlebar', win);
  let sx=0, sy=0, ox=0, oy=0, dragging=false;
  if (!bar) return;
  bar.style.touchAction='none';

  function isControlTarget(ev){
    const t = ev.target;
    return t.classList.contains('btn') || t.closest('.tb-actions');
  }

  function onDown(e){
    if (isControlTarget(e)) return; // don't start drag when clicking buttons
    dragging=true; bring(win);
    const p = ('clientX' in e)? e : e.touches[0];
    sx=p.clientX; sy=p.clientY;
    const r=win.getBoundingClientRect(); ox=r.left; oy=r.top;
  }
  function onMove(e){
    if(!dragging) return;
    const p = ('clientX' in e)? e : (e.touches? e.touches[0] : null); if(!p) return;
    win.style.left = (ox + p.clientX - sx) + 'px';
    win.style.top  = (oy + p.clientY - sy) + 'px';
  }
  function onUp(){ if(!dragging) return; dragging=false; keepInView(win); }

  if (window.PointerEvent){
    bar.addEventListener('pointerdown', onDown);
    window.addEventListener('pointermove', onMove);
    window.addEventListener('pointerup', onUp);
  } else {
    bar.addEventListener('mousedown', onDown);
    window.addEventListener('mousemove', onMove);
    window.addEventListener('mouseup', onUp);
    bar.addEventListener('touchstart', onDown, {passive:true});
    window.addEventListener('touchmove', onMove, {passive:false});
    window.addEventListener('touchend', onUp);
  }
  win.addEventListener('mousedown', ()=> bring(win));
}
qsa('.win').forEach(makeDraggable);

function show(sel){ const w=qs(sel); if(!w) return; w.classList.remove('hidden'); bring(w); if (window.innerWidth<700){ maximize(sel); } }
function hide(sel){ const w=qs(sel); if(!w) return; w.classList.add('hidden'); }
function minimize(sel){
  hide(sel);
  const w=qs(sel); if(!w) return;
  const t=qs('.tb-title',w).textContent;
  const b=document.createElement('button'); b.className='taskbtn'; b.textContent=t;
  b.onclick=()=>{ show(sel); b.remove(); };
  qs('#tasks').appendChild(b);
}
function maximize(sel){
  const w=qs(sel); if(!w) return;
  if(w.dataset.maxed==='1'){
    w.style.left='8vw'; w.style.top='80px'; w.style.width='84vw'; w.style.height='70vh'; w.dataset.maxed='0';
  } else {
    w.style.left='2vw'; w.style.top='54px'; w.style.width='96vw'; w.style.height='calc(100vh - 110px)'; w.dataset.maxed='1';
  }
  bring(w);
}
function closew(sel){ hide(sel); }

qsa('[data-open]').forEach(i=>{
  i.addEventListener('click',()=>{
    const sel=i.getAttribute('data-open'); const w=qs(sel);
    if (w && w.classList.contains('hidden')) show(sel); else if (w) bring(w);
  });
  i.addEventListener('keydown',(e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); i.click(); }});
});

// Explicit listeners
qsa('[data-min]').forEach(b=> b.addEventListener('click', ()=> minimize(b.getAttribute('data-min')) ));
qsa('[data-max]').forEach(b=> b.addEventListener('click', ()=> maximize(b.getAttribute('data-max')) ));
qsa('[data-close]').forEach(b=> b.addEventListener('click', ()=> closew(b.getAttribute('data-close')) ));

// Keep windows in view on resize
window.addEventListener('resize', ()=> qsa('.win:not(.hidden)').forEach(keepInView));

// ----- About: neofetch -----
function updateNeofetch(){
  const res = `${window.innerWidth}x${window.innerHeight}`;
  const theme = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
  const lines = [
    'jesus@nixos',
    '---------------------------',
    'OS: NixOS 24.05 (Uakari)',
    'Host: Web Portfolio (CanvasWM)',
    'Kernel: HTML5 1.0 (JS Engine)',
    `Resolution: ${res}`,
    `Theme: Nix — accent ${theme}`,
    'Packages: 0 (nix, simulated)',
    'Shell: pseudo-shell (safe)',
    'Terminal: browser console (safe)',
    'CPU: Focus x1',
    'GPU: Imagination x∞',
    'Memory: Plenty (client-side)'
  ];
  const nf=qs('#neofetch'); if (nf) nf.textContent = lines.join('
');
}
window.addEventListener('resize', updateNeofetch); updateNeofetch();

// ----- Terminal -----
const out=qs('#term-out'), tin=qs('#term-in');
function println(s){ if(!out) return; out.textContent+=(s?s:'')+(s===''?'':'
'); out.scrollTop=out.scrollHeight; }
function printlnHTML(html){ if(!out) return; const div=document.createElement('div'); div.innerHTML=html; out.appendChild(div); out.appendChild(document.createTextNode('
')); out.scrollTop=out.scrollHeight; }
if (out && tin){
  const cmds={
    help:()=> "Commands: help, whoami, date, projects, clear",
    whoami:()=> "jesus@nixos",
    date:()=> new Intl.DateTimeFormat('en-US',{ timeZone:'America/Mexico_City', dateStyle:'full', timeStyle:'long', hour12: localStorage.getItem('clock24')!=='1' }).format(new Date()),
    projects:()=> { printlnHTML('<ul style="margin:6px 0 0 18px>'
        + '<li><a href="https://github.com/jmartinez117/vt_batch" target="_blank" rel="noopener noreferrer">vt_batch</a> — Python + VirusTotal</li>'
        + '<li><a href="https://github.com/jmartinez117/log_pulse" target="_blank" rel="noopener noreferrer">log_pulse</a> — Log parser</li>'
        + '<li><a href="https://cloudflare-lab-81v.pages.dev/" target="_blank" rel="noopener noreferrer">cloudflare-lab</a> — Cloudflare Pages lab</li>'
        + '</ul>'); return ''; },
    clear:()=> { out.textContent=''; return ''; }
  };
  println("Type 'help' to see commands.");
  tin.addEventListener('keydown', e=>{
    if(e.key==='Enter'){
      const c=tin.value.trim();
      println('> ' + c);
      if (c in cmds){ const r = cmds[c](); if (r) println(r); }
      else if (c.length){ println("Unknown command. Type 'help'."); }
      tin.value='';
    }
  });
}
  </script>
</body>
</html>
