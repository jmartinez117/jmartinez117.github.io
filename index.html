<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jesús R. Martínez Urrutia — NixOS Desktop • Portfolio</title>
  <meta name="description" content="Interactive Linux desktop portfolio — responsive, password gate, draggable windows (About, Resume, Projects, Contact, Settings, Mousepad, Terminal). Mexico City clock.">
  <!-- CSP: allow inline script so the login works after minimal edits -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://brand.nixos.org https://upload.wikimedia.org; frame-src 'self'; object-src 'none'; base-uri 'none'; frame-ancestors 'none'; upgrade-insecure-requests">
  <meta http-equiv="Referrer-Policy" content="no-referrer">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta name="color-scheme" content="dark light">
  <style>
:root{
  --bg-1:#0d1220; --bg-2:#0a1a2f;
  --accent:#5277C3; --accent-2:#7EBAE4;
  --ink:#e7ecff; --muted:#b8c3e6;
  --line:#233053; --panel:#0f1b33; --panel-2:#101a30;
  --win:#121f3b; --task:#0a1428; --ok:#14b8a6; --warn:#f59e0b; --bad:#ef4444;
  --shadow:0 18px 50px rgba(0,0,0,.45);
  --brightness:1; --contrast:1;
  --win-h: 70vh;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
  font-size: clamp(14px, 1.6vw, 16px);
  color:var(--ink);
  background: url('bg.svg') center / cover fixed no-repeat,
              linear-gradient(120deg, var(--bg-1), var(--bg-2));
  overflow:hidden;
  filter: brightness(var(--brightness)) contrast(var(--contrast));
}
.topbar{
  position:fixed;inset:0 0 auto 0;height:46px;display:flex;align-items:center;gap:12px;
  background:linear-gradient(180deg, rgba(0,0,0,.25), transparent);
  border-bottom:1px solid var(--line);padding:0 12px;z-index:1000;
  backdrop-filter:blur(8px); -webkit-backdrop-filter: blur(8px);
}
.nixlogo{display:inline-flex;align-items:center;gap:10px;padding:6px 10px;border-radius:10px;background:rgba(0,0,0,.28);border:1px solid var(--line)}
.nixlogo img{height:22px;width:auto;display:block}
.title{font-weight:600;font-size:clamp(14px,1.8vw,16px)}
.spacer{flex:1}
.status{display:flex;gap:10px;color:var(--muted);font-size:clamp(12px,1.4vw,14px)}
.hidden{display:none !important}
/* Login */
.login{position:fixed;inset:0;display:grid;place-items:center;z-index:1500;background:linear-gradient(160deg, #08101f, #0b1830)}
.loginbox{width:min(520px, 92vw);padding:22px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,.04), transparent), #0f1d38;border:1px solid var(--line); box-shadow:var(--shadow)}
.loginbox h1{margin:0 0 6px 0;font-size:22px}
.input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:#0b142b;color:var(--ink)}
#login-error{color:#ff7373;font-size:12px;height:14px;opacity:.9;margin-top:6px}
/* Dock */
.dock{position:fixed;inset:auto 12px 58px auto;display:grid;gap:12px;grid-auto-flow:row;justify-items:center}
.icon{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,var(--panel),var(--panel-2));border:1px solid var(--line);display:grid;place-items:center;box-shadow:var(--shadow);cursor:pointer;transition:transform .12s ease}
.icon:hover{transform:translateY(-2px)}.icon svg{width:28px;height:28px}
.label{font-size:12px;color:var(--muted);margin-top:4px}
/* Windows */
.win{
  position:absolute;top:90px;left:8vw;width:84vw;max-height:var(--win-h);display:grid;grid-template-rows:auto 1fr;
  background:linear-gradient(180deg, rgba(255,255,255,.03), transparent), var(--win);
  border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);overflow:hidden
}
.titlebar{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid var(--line);background:linear-gradient(180deg, rgba(255,255,255,.05), transparent);cursor:move;user-select:none;touch-action:none}
.tb-title{font-weight:600}.tb-actions{margin-left:auto;display:flex;gap:8px}
.btn{width:12px;height:12px;border-radius:999px;border:1px solid var(--line);cursor:pointer}
.btn.close{background:var(--bad)} .btn.min{background:var(--warn)} .btn.max{background:var(--ok)}
.content{padding:16px;overflow:auto}
.terminal{background:#0a0f1e;border:1px solid #1b2442;border-radius:12px;padding:12px 14px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;font-size:14px;color:#cfe0ff}
.prompt{color:var(--accent-2)}
/* Make neofetch extra tidy inside the window */
#neofetch{font-size:13px; line-height:1.4; white-space:pre-wrap; word-wrap:break-word}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
.card{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent), #0f1d38;border:1px solid var(--line);border-radius:14px;padding:16px}
.chips{display:flex;flex-wrap:wrap;gap:10px}
.chip{background:#111f3c;border:1px solid #2b3a6a;color:#dbe6ff;padding:8px 12px;border-radius:999px;font-size:.95rem}
/* Taskbar */
.taskbar{position:fixed;inset:auto 0 0 0;height:52px;display:flex;align-items:center;gap:10px;padding:0 10px;background:linear-gradient(0deg, rgba(0,0,0,.2), transparent);border-top:1px solid var(--line);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
.taskbtn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;background:rgba(0,0,0,.18);border:1px solid var(--line);color:var(--ink);cursor:pointer;max-width:220px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.taskbtn.active{outline:2px solid var(--accent)}
.center-intro{position:fixed;inset:0;display:grid;place-items:center;pointer-events:none}
.center-intro .inner{background:rgba(0,0,0,.15);border:1px solid var(--line);padding:14px 18px;border-radius:12px;color:var(--muted)}
a{color:var(--accent);text-decoration:none}a:hover{text-decoration:underline}
pre{white-space:pre-wrap;word-wrap:break-word; line-height:1.35; font-size:14px}
.reduce-motion *{ transition:none !important; animation:none !important; }

/* Responsive tweaks (kept) */
@media (max-width:900px){
  .win{left:5vw;width:90vw}
}
@media (max-width:700px){
  .dock{inset:auto 50% 68px auto;transform:translateX(50%);grid-auto-flow:column}
  .icon{width:52px;height:52px}.icon svg{width:26px;height:26px}
  .win{top:70px;left:2vw;width:96vw;max-height:calc(100dvh - 120px)}
  @supports not (height: 100dvh){ .win{ max-height:calc(100vh - 120px); } }
  .title{font-size:clamp(14px,3.5vw,18px)}
  .status{font-size:clamp(12px,3.1vw,16px)}
}
  </style>
</head>
<body>
  <!-- LOGIN SCREEN (password required: HireMe2025!) -->
  <div id="login" class="login">
    <div class="loginbox">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <img alt="NixOS logo" src="https://brand.nixos.org/logos/nixos-logomark-default-gradient-recommended.svg" height="32" width="32">
        <h1 style="margin:0">NixOS — Session</h1>
      </div>
      <p style="color:var(--muted);margin-top:0">Enter the passphrase to open the desktop experience.</p>
      <input id="password" class="input" type="password" placeholder="Password (hint: year you're hiring me)">
      <div id="login-error" role="alert" aria-live="polite"></div>
      <div style="display:flex;gap:10px;margin-top:12px">
        <button id="login-btn" type="button" class="input" style="cursor:pointer;background:linear-gradient(135deg,var(--accent),var(--accent-2));border:1px solid var(--line)">Enter</button>
      </div>
      <p style="color:var(--muted);font-size:12px;margin-top:10px">Privacy note: static site — no data leaves your browser.</p>
    </div>
  </div>

  <!-- DESKTOP -->
  <div id="desktop" class="hidden">
    <div class="topbar" role="banner">
      <div class="nixlogo" title="NixOS" aria-label="NixOS">
        <img alt="NixOS logo" src="https://brand.nixos.org/logos/nixos-logomark-default-gradient-recommended.svg">
        <span class="title">NixOS Desktop</span>
      </div>
      <div class="spacer"></div>
      <div class="status"><span>jesus@nixos</span><span aria-hidden="true">•</span><span id="clock" aria-live="polite"></span></div>
    </div>

    <!-- Dock -->
    <div class="dock" aria-label="App Dock">
      <div class="icon" data-open="#win-about" role="button" tabindex="0" title="About">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
      </div><div class="label">About</div>
      <div class="icon" data-open="#win-resume" role="button" tabindex="0" title="Resume">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16l6-3 6 3V8z"/></svg>
      </div><div class="label">Resume</div>
      <div class="icon" data-open="#win-projects" role="button" tabindex="0" title="Projects">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M3 7h18M3 12h18M3 17h18"/></svg>
      </div><div class="label">Projects</div>
      <div class="icon" data-open="#win-terminal" role="button" tabindex="0" title="Terminal">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M8 9l3 3-3 3M13 15h3"/></svg>
      </div><div class="label">Terminal</div>
      <div class="icon" data-open="#win-mousepad" role="button" tabindex="0" title="Mousepad">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M4 4h16v16H4zM8 8h8M8 12h8M8 16h5"/></svg>
      </div><div class="label">Mousepad</div>
      <div class="icon" data-open="#win-settings" role="button" tabindex="0" title="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V22a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9c0 .66.26 1.3.73 1.77.48.47 1.12.73 1.77.73H22a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      </div><div class="label">Settings</div>
      <div class="icon" data-open="#win-contact" role="button" tabindex="0" title="Contact">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M4 4h16v12H5.17 L4 17.17V4z"/><path d="m22 6-10 7L2 6"/></svg>
      </div><div class="label">Contact</div>
    </div>

    <!-- WINDOWS -->
    <section class="win" id="win-about" style="top:86px;left:6vw" role="dialog" aria-label="About">
      <div class="titlebar"><span class="tb-title">About</span><div class="tb-actions"><div class="btn min" data-min="#win-about"></div><div class="btn max" data-max="#win-about"></div><div class="btn close" data-close="#win-about"></div></div></div>
      <div class="content">
        <div class="terminal" role="region" aria-label="neofetch output"><pre id="neofetch"></pre></div>
        <p style="color:var(--muted);margin-top:12px">
          Hi! I’m Jesús — a Security+ certified, hands-on IT professional moving deeper into security.
          I enjoy troubleshooting complex connectivity issues, reading firewall and endpoint logs,
          and automating repetitive triage with Python. I’m actively seeking an IT role — ideally as a
          <strong>Technical Support Engineer</strong> or <strong>SOC/Cybersecurity Analyst (Tier-1)</strong> — where I can combine support discipline with security operations and grow my detection & response skills.
        </p>
        <p>Links: <a href="mailto:ricardo.mtz.u117@gmail.com" target="_blank">Email</a> ·
           <a href="https://linkedin.com/in/jesus-ricardo-martinez-urrutia-3024731a5" target="_blank">LinkedIn</a> ·
           <a href="https://github.com/jmartinez117" target="_blank">GitHub</a></p>
      </div>
    </section>

    <section class="win hidden" id="win-resume" role="dialog" aria-label="Resume">
      <div class="titlebar"><span class="tb-title">Resume</span><div class="tb-actions"><div class="btn min" data-min="#win-resume"></div><div class="btn max" data-max="#win-resume"></div><div class="btn close" data-close="#win-resume"></div></div></div>
      <div class="content">
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
          <button id="btn-struct" class="taskbtn" type="button">Structured</button>
          <button id="btn-raw" class="taskbtn" type="button">Plain text</button>
          <button id="btn-pdf" class="taskbtn" type="button">PDF viewer</button>
          <a class="taskbtn" href="resume.pdf" target="_blank">Open PDF (new tab)</a>
        </div>
        <div id="resume-struct">
          <h3>Experience</h3>
          <div class="card">
            <strong>Technical Support Engineer (Level 1 → Security-Aware Tier 2) — ONESUPPORT</strong>
            <div class="muted">May 2023 – Present · Mexico City (remote), US-based ISP</div>
            <ul>
              <li>Resolve ~30 connectivity, OS and SaaS tickets/day; SLA &gt;95%.</li>
              <li>Review FortiGate logs; open ~10 follow-up SOC cases/month.</li>
              <li>Weekly Nessus Essentials scans on ~50 endpoints; report critical CVEs.</li>
              <li>Python + VirusTotal automation saves ~10 min per malware ticket.</li>
              <li>Assist with firewall rule changes; authored 25 KB articles.</li>
            </ul>
          </div>
          <div class="card">
            <strong>Software Developer — PROMOIMPRESOS</strong>
            <div class="muted">Sep 2019 – Feb 2023 · Mexico City</div>
            <ul>
              <li>C#/WPF app automated order workflow (−70% manual entry).</li>
              <li>Fixed SQL injection in legacy PHP; introduced Git.</li>
              <li>PowerShell backups for SQL Server (RPO 15 min).</li>
              <li>Active Directory: training, logins, configuration.</li>
            </ul>
          </div>
          <h3>Skills</h3>
          <div class="chips">
            <span class="chip">Splunk</span><span class="chip">Nessus</span><span class="chip">FortiGate</span><span class="chip">Wireshark</span>
            <span class="chip">Burp Suite</span><span class="chip">nmap</span><span class="chip">Python</span><span class="chip">PowerShell</span>
            <span class="chip">C#/.NET</span><span class="chip">C++</span><span class="chip">React.js</span><span class="chip">SQL</span>
            <span class="chip">AWS</span><span class="chip">Azure Sentinel</span><span class="chip">Docker</span><span class="chip">NixOS</span>
          </div>
          <h3>Education & Certifications</h3>
          <div class="grid">
            <div class="card"><strong>CompTIA Security+</strong><div class="muted">Issued Mar 2025 — Code: ERCVSQ6QZF411L3X</div></div>
            <div class="card"><strong>B.S. Cybersecurity — Universidad Utel</strong><div class="muted">In progress — expected 2028.</div></div>
            <div class="card"><strong>B.S. Data Science — Universidad del Valle de México</strong><div class="muted">2 years completed (2025).</div></div>
            <div class="card"><strong>B.S. Software Engineering — Universidad del Valle de México</strong><div class="muted">2 years completed (2023) — GPA 3.7.</div></div>
            <div class="card"><strong>A.S. Electronics — Escuela Mexicana de Electricidad</strong><div class="muted">Grad Sep 2019 — GPA 3.8.</div></div>
          </div>
          <p class="muted">Languages: Spanish (native) · English C1 (CAE) · French A1</p>
        </div>
        <div id="resume-raw" class="hidden">
          <pre></pre>
        </div>
        <div id="resume-pdf" class="hidden">
          <iframe src="resume.pdf" title="Resume PDF" style="width:100%;height:70vh;border:1px solid var(--line);border-radius:10px;background:#0b142b"></iframe>
        </div>
      </div>
    </section>

    <section class="win hidden" id="win-projects" role="dialog" aria-label="Projects">
      <div class="titlebar"><span class="tb-title">Projects</span><div class="tb-actions"><div class="btn min" data-min="#win-projects"></div><div class="btn max" data-max="#win-projects"></div><div class="btn close" data-close="#win-projects"></div></div></div>
      <div class="content">
        <div class="grid">
          <div class="card">
            <h4>cloudflare-lab</h4>
            <p class="muted">Cloudflare Pages lab — deployment/test project.</p>
            <p><a id="proj-cloudflare" href="https://cloudflare-lab-81v.pages.dev/" target="_blank" rel="noopener noreferrer">Open project</a></p>
          </div>
          <div class="card">
            <h4>vt_batch</h4>
            <p class="muted">Python tool to hash files and bulk-query VirusTotal for faster malware triage.</p>
            <a href="https://github.com/jmartinez117/vt_batch" target="_blank" rel="noopener noreferrer">Source</a>
          </div>
          <div class="card">
            <h4>log_pulse</h4>
            <p class="muted">Mini log viewer parsing common firewall formats for quick IOC scanning.</p>
            <a href="https://github.com/jmartinez117/log_pulse" target="_blank" rel="noopener noreferrer">Source</a>
          </div>
        </div>
      </div>
    </section>

    <section class="win hidden" id="win-terminal" role="dialog" aria-label="Terminal">
      <div class="titlebar"><span class="tb-title">Terminal</span><div class="tb-actions"><div class="btn min" data-min="#win-terminal"></div><div class="btn max" data-max="#win-terminal"></div><div class="btn close" data-close="#win-terminal"></div></div></div>
      <div class="content">
        <div class="terminal" style="height:48vh;overflow:auto" id="term-out"></div>
        <input id="term-in" class="input" placeholder="Type a command (try 'help')" />
      </div>
    </section>

    <section class="win hidden" id="win-mousepad" role="dialog" aria-label="Mousepad">
      <div class="titlebar"><span class="tb-title">Mousepad</span><div class="tb-actions"><div class="btn min" data-min="#win-mousepad"></div><div class="btn max" data-max="#win-mousepad"></div><div class="btn close" data-close="#win-mousepad"></div></div></div>
      <div class="content">
        <textarea id="mousepad-area" class="input" style="min-height:46vh" placeholder="Type notes here..."></textarea>
        <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
          <button id="mousepad-save" class="taskbtn" type="button">Save (local)</button>
          <button id="mousepad-load" class="taskbtn" type="button">Load</button>
          <span id="mousepad-status" class="muted"></span>
        </div>
      </div>
    </section>

    <section class="win hidden" id="win-settings" role="dialog" aria-label="Settings">
      <div class="titlebar"><span class="tb-title">Settings</span><div class="tb-actions"><div class="btn min" data-min="#win-settings"></div><div class="btn max" data-max="#win-settings"></div><div class="btn close" data-close="#win-settings"></div></div></div>
      <div class="content">
        <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px">
          <div class="card">
            <h4>Display</h4>
            <label>Brightness: <input id="range-brightness" type="range" min="50" max="130" value="100"></label><br/>
            <label>Contrast: <input id="range-contrast" type="range" min="70" max="130" value="100"></label>
            <p class="muted">Adjusts the whole interface in real-time. Saved locally.</p>
          </div>
          <div class="card">
            <h4>Accent theme</h4>
            <label style="display:block;margin-bottom:6px"><input type="radio" name="accent" value="nixos" checked> NixOS (blue)</label>
            <label style="display:block;margin-bottom:6px"><input type="radio" name="accent" value="ubuntu"> Ubuntu (orange)</label>
            <label style="display:block;"><input type="radio" name="accent" value="kali"> Kali (cyan)</label>
          </div>
          <div class="card">
            <h4>Clock</h4>
            <label><input id="toggle-24" type="checkbox"> 24-hour time</label>
          </div>
          <div class="card">
            <h4>Accessibility</h4>
            <label><input id="toggle-motion" type="checkbox"> Reduce motion</label>
          </div>
          <div class="card">
            <h4>System</h4>
            <button id="btn-reset" class="taskbtn" type="button">Reset UI & preferences</button>
            <p class="muted">Resets window positions and preferences to defaults.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="win hidden" id="win-contact" role="dialog" aria-label="Contact">
      <div class="titlebar"><span class="tb-title">Contact</span><div class="tb-actions"><div class="btn min" data-min="#win-contact"></div><div class="btn max" data-max="#win-contact"></div><div class="btn close" data-close="#win-contact"></div></div></div>
      <div class="content">
        <form action="https://formspree.io/f/your-id" method="POST">
          <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
            <input type="text" name="name" placeholder="Your name" required class="input">
            <input type="email" name="email" placeholder="Your email" required class="input">
          </div>
          <textarea name="message" placeholder="Your message" required class="input" style="margin-top:10px;min-height:120px"></textarea>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <button type="submit" class="taskbtn">Send</button>
            <a href="mailto:ricardo.mtz.u117@gmail.com" target="_blank" class="taskbtn">Or email me directly</a>
          </div>
        </form>
      </div>
    </section>

    <div class="taskbar" aria-label="Taskbar">
      <div id="tasks" style="display:flex;gap:8px;flex-wrap:wrap"></div>
      <div class="spacer"></div>
      <div class="muted" style="padding-right:10px">© <span id="year"></span> Jesús R. Martínez Urrutia</div>
    </div>
    <div class="center-intro"><div class="inner">Click icons to open/bring to front. Close just hides — reopen anytime from the dock.</div></div>
  </div>

  <script>
/* NixOS Desktop v6 — minimal changes: always-ask login + neofetch expand + button-safe dragging */
'use strict';
const qs=(s,e=document)=>e.querySelector(s), qsa=(s,e=document)=>Array.from(e.querySelectorAll(s));
qsa('a[target="_blank"]').forEach(a=>{a.rel='noopener noreferrer'});

// ----- Utility: viewport-safe positioning -----
function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }
function keepInView(win){
  const r = win.getBoundingClientRect();
  const pad = 10;
  const maxL = window.innerWidth - r.width - pad;
  const maxT = window.innerHeight - r.height - 72; // allow for taskbar/topbar
  win.style.left = clamp(r.left, pad, Math.max(pad, maxL)) + 'px';
  win.style.top  = clamp(r.top,  54,  Math.max(54,  maxT)) + 'px';
}

// ----- Clock (Mexico City, 12/24h toggle) -----
function updateClock(){
  const d = new Date();
  const use24 = localStorage.getItem('clock24') === '1';
  const fmt = new Intl.DateTimeFormat('en-US', {
    timeZone:'America/Mexico_City', hour:'2-digit', minute:'2-digit', second:'2-digit',
    year:'numeric', month:'short', day:'2-digit', hour12: !use24
  });
  qs('#clock').textContent = fmt.format(d) + ' (Mexico City)';
  qs('#year').textContent = String(d.getFullYear());
}
setInterval(updateClock, 1000); updateClock();

// ----- Login (password: always ask; no persistence) -----
const REQUIRED_PW='HireMe2025!';
const login=qs('#login'), desktop=qs('#desktop');
const loginBtn=qs('#login-btn'), pwInput=qs('#password'), loginError=qs('#login-error');
function unlock(){ login.classList.add('hidden'); desktop.classList.remove('hidden'); }
function tryUnlock(){
  const pw = pwInput.value.trim();
  if (pw===REQUIRED_PW){ unlock(); }
  else {
    loginError.textContent='Incorrect password.'; loginError.style.opacity='1';
    qs('.loginbox').animate([{transform:'translateX(0)'},{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:250});
  }
}
loginBtn.addEventListener('click', tryUnlock);
pwInput.addEventListener('keydown', e=>{ if(e.key==='Enter') tryUnlock(); });
// NOTE: removed previous auto-unlock via localStorage to always require password

// ----- Window manager (pointer events, re-openable) -----
let z=10;
function bring(el){ el.style.zIndex=String(++z); }
function makeDraggable(win){
  const bar = qs('.titlebar', win);
  let sx=0, sy=0, ox=0, oy=0, dragging=false;
  bar.style.touchAction='none'; // allow pointer drag on mobile

  // NEW: don't start drag when clicking the window controls
  function isControlTarget(e){ const t=e.target; return t.classList.contains('btn') || t.closest('.tb-actions'); }

  function onDown(e){
    if (isControlTarget(e)) return;
    dragging=true; bring(win);
    const p = ('clientX' in e)? e : e.touches[0];
    sx=p.clientX; sy=p.clientY;
    const r=win.getBoundingClientRect(); ox=r.left; oy=r.top;
    if (bar.setPointerCapture && e.pointerId!==undefined) bar.setPointerCapture(e.pointerId);
  }
  function onMove(e){
    if(!dragging) return;
    const p = ('clientX' in e)? e : (e.touches? e.touches[0] : null); if(!p) return;
    win.style.left = (ox + p.clientX - sx) + 'px';
    win.style.top  = (oy + p.clientY - sy) + 'px';
  }
  function onUp(){ if(!dragging) return; dragging=false; keepInView(win); }

  if (window.PointerEvent){
    bar.addEventListener('pointerdown', onDown);
    window.addEventListener('pointermove', onMove);
    window.addEventListener('pointerup', onUp);
  } else {
    bar.addEventListener('mousedown', onDown);
    window.addEventListener('mousemove', onMove);
    window.addEventListener('mouseup', onUp);
    bar.addEventListener('touchstart', onDown, {passive:true});
    window.addEventListener('touchmove', onMove, {passive:false});
    window.addEventListener('touchend', onUp);
  }
  win.addEventListener('mousedown', ()=> bring(win));
}
qsa('.win').forEach(makeDraggable);
function show(sel){ const w=qs(sel); if(!w) return; w.classList.remove('hidden'); bring(w); if (window.innerWidth<700){ maximize(sel); } }
function hide(sel){ const w=qs(sel); if(!w) return; w.classList.add('hidden'); }
function minimize(sel){
  hide(sel);
  const w=qs(sel); const t=qs('.tb-title',w).textContent;
  const b=document.createElement('button'); b.className='taskbtn'; b.textContent=t;
  b.onclick=()=>{ show(sel); b.remove(); };
  qs('#tasks').appendChild(b);
}
function maximize(sel){
  const w=qs(sel); if(!w) return;
  if(w.dataset.maxed==='1'){
    w.style.left='8vw'; w.style.top='80px'; w.style.width='84vw'; w.style.height='var(--win-h,68vh)'; w.dataset.maxed='0';
  } else {
    w.style.left='2vw'; w.style.top='54px';
    w.style.width='96vw';
    w.style.height='calc(var(--vh, 100vh) - 100px)'; // mobile friendly
    w.dataset.maxed='1';
  }
  bring(w);
}
function closew(sel){ hide(sel); }
qsa('[data-open]').forEach(i=>i.addEventListener('click',()=>{
  const sel=i.getAttribute('data-open'); const w=qs(sel);
  if (w && w.classList.contains('hidden')) show(sel); else if (w) bring(w);
}));
qsa('[data-min]').forEach(b=>b.addEventListener('click',()=>minimize(b.getAttribute('data-min'))));
qsa('[data-max]').forEach(b=>b.addEventListener('click',()=>maximize(b.getAttribute('data-max'))));
qsa('[data-close]').forEach(b=>b.addEventListener('click',()=>closew(b.getAttribute('data-close'))));
window.addEventListener('resize', ()=> qsa('.win:not(.hidden)').forEach(keepInView));

// Mobile 100vh fix: compute CSS var --vh
function setVh(){ document.documentElement.style.setProperty('--vh', window.innerHeight + 'px'); }
setVh(); window.addEventListener('resize', setVh);

// ----- About: expanded neofetch (kept tidy) -----
function updateNeofetch(){
  const res = `${window.innerWidth}x${window.innerHeight}`;
  const theme = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
  const lines = [
    'jesus@nixos',
    '---------------------------',
    'OS: NixOS 24.05 (Uakari)',
    'Host: Web Portfolio',
    'DE: Nix Desktop (web)',   // new
    'WM: CanvasWM',           // new
    'Kernel: HTML5 1.0 (JS)',
    `Resolution: ${res}`,
    `Theme: Nix — accent ${theme}`,
    'Icons: Nerd (sim)',      // new
    'Packages: 0 (simulated)',
    'Shell: pseudo-shell',
    'Terminal: browser console',
    'CPU: Focus x1',
    'GPU: Imagination x∞',
    'Memory: Plenty (client-side)'
  ];
  qs('#neofetch').textContent = lines.join('\\n');
}
window.addEventListener('resize', updateNeofetch);
updateNeofetch();

// ----- Terminal -----
const out=qs('#term-out'), tin=qs('#term-in');
function println(s){ out.textContent+=(s?s:'')+(s===''?'':'\\n'); out.scrollTop=out.scrollHeight; }
function printlnHTML(html){ const div=document.createElement('div'); div.innerHTML=html; out.appendChild(div); out.appendChild(document.createTextNode('\\n')); out.scrollTop=out.scrollHeight; }
const cmds={
  help:()=> "Commands: help, whoami, date, projects, clear",
  whoami:()=> "jesus@nixos",
  date:()=> new Intl.DateTimeFormat('en-US',{ timeZone:'America/Mexico_City', dateStyle:'full', timeStyle:'long', hour12: localStorage.getItem('clock24')!=='1' }).format(new Date()),
  projects:()=> { printlnHTML('<ul style="margin:6px 0 0 18px">'
      + '<li><a href="https://github.com/jmartinez117/vt_batch" target="_blank" rel="noopener noreferrer">vt_batch</a> — Python + VirusTotal</li>'
      + '<li><a href="https://github.com/jmartinez117/log_pulse" target="_blank" rel="noopener noreferrer">log_pulse</a> — Log parser</li>'
      + '<li><a href="https://cloudflare-lab-81v.pages.dev/" target="_blank" rel="noopener noreferrer">cloudflare-lab</a> — Cloudflare Pages lab</li>'
      + '</ul>'); return ''; },
  clear:()=> { out.textContent=''; return ''; }
};
println("Type 'help' to see commands.");
tin.addEventListener('keydown', e=>{
  if(e.key==='Enter'){
    const c=tin.value.trim();
    println('> ' + c);
    if (c in cmds){ const r = cmds[c](); if (r) println(r); }
    else if (c.length){ println("Unknown command. Type 'help'."); }
    tin.value='';
  }
});

// ----- Resume verbatim cleanup (unchanged) -----
(function moreVerbatimCleanup(){
  const pre = qs('#resume-raw pre'); if(!pre) return;
  let t = pre.textContent;
  t = t.replace(/\u00AD/g, '').replace(/ ?-\s*\n\s*/g, '-').replace(/\n{3,}/g,'\n\n');
  pre.textContent = t;
})();

// ----- Settings (unchanged) -----
const bright=qs('#range-brightness'); const contrast=qs('#range-contrast');
const themePick=qsa('input[name="accent"]'); const clockToggle=qs('#toggle-24'); const motionToggle=qs('#toggle-motion');

function applySettingsFromStorage(){
  const b=parseFloat(localStorage.getItem('brightness')||'1');
  const c=parseFloat(localStorage.getItem('contrast')||'1');
  document.documentElement.style.setProperty('--brightness', String(b));
  document.documentElement.style.setProperty('--contrast', String(c));
  if (bright) bright.value = String(Math.round(b*100));
  if (contrast) contrast.value = String(Math.round(c*100));
  const accent = localStorage.getItem('accent') || 'nixos';
  themePick.forEach(r=>{ r.checked = (r.value===accent); });
  setAccent(accent);
  const clock24 = localStorage.getItem('clock24')==='1'; if (clockToggle) clockToggle.checked = clock24;
  const reduce = localStorage.getItem('reduceMotion')==='1'; if (motionToggle) motionToggle.checked = reduce;
  document.documentElement.classList.toggle('reduce-motion', reduce);
  updateClock(); updateNeofetch();
}
function setAccent(val){
  if (val==='ubuntu'){ document.documentElement.style.setProperty('--accent','#E95420'); document.documentElement.style.setProperty('--accent-2','#F4A261'); }
  else if (val==='kali'){ document.documentElement.style.setProperty('--accent','#268BD2'); document.documentElement.style.setProperty('--accent-2','#6EC1F2'); }
  else { document.documentElement.style.setProperty('--accent','#5277C3'); document.documentElement.style.setProperty('--accent-2','#7EBAE4'); }
}
if (bright) bright.addEventListener('input', ()=>{
  const v = Math.max(50, Math.min(130, parseInt(bright.value,10)))/100;
  document.documentElement.style.setProperty('--brightness', String(v));
  localStorage.setItem('brightness', String(v));
});
if (contrast) contrast.addEventListener('input', ()=>{
  const v = Math.max(70, Math.min(130, parseInt(contrast.value,10)))/100;
  document.documentElement.style.setProperty('--contrast', String(v));
  localStorage.setItem('contrast', String(v));
});
themePick.forEach(r=> r.addEventListener('change', ()=>{
  setAccent(r.value); localStorage.setItem('accent', r.value); updateNeofetch();
}));
if (clockToggle) clockToggle.addEventListener('change', ()=>{
  localStorage.setItem('clock24', clockToggle.checked ? '1' : '0'); updateClock();
});
if (motionToggle) motionToggle.addEventListener('change', ()=>{
  localStorage.setItem('reduceMotion', motionToggle.checked ? '1' : '0');
  document.documentElement.classList.toggle('reduce-motion', motionToggle.checked);
});

const resetBtn = qs('#btn-reset');
if (resetBtn) resetBtn.addEventListener('click', ()=>{
  localStorage.removeItem('brightness'); localStorage.removeItem('contrast');
  localStorage.removeItem('accent'); localStorage.removeItem('clock24'); localStorage.removeItem('reduceMotion');
  qsa('.win').forEach(w=>{ w.style.left='8vw'; w.style.top='90px'; w.style.width='84vw'; w.style.height='var(--win-h,68vh)'; w.dataset.maxed='0'; });
  applySettingsFromStorage();
});

applySettingsFromStorage();
  </script>
</body>
</html>
